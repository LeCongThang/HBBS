(function($) {
    "use strict"; // Start of use strict

    // jQuery for page scrolling feature - requires jQuery Easing plugin
    $('a.page-scroll').bind('click', function(event) {
        var $anchor = $(this);
        $('html, body').stop().animate({
            scrollTop: ($($anchor.attr('href')).offset().top)
        }, 1250, 'easeInOutExpo');
        event.preventDefault();
    });

    // Highlight the top nav as scrolling occurs
    $('body').scrollspy({
        target: '.navbar-fixed-top',
        offset: 0
    });

    // Closes the Responsive Menu on Menu Item Click
    $('.navbar-collapse ul li a').click(function() {
        $('.navbar-toggle:visible').click();
    });

    // Offset for Main Navigation
    $('#mainNav').affix({
        offset: {
            top: 0
        }
    })



})(jQuery); // End of use strict
$(document).ready(function () {
    $(".btn-select").each(function (e) {
        var value = $(this).find("ul li.selected").html();
        if (value != undefined) {
            $(this).find(".btn-select-input").val(value);
            $(this).find(".btn-select-value").html(value);
        }
    });
});

$(document).on('click', '.btn-select', function (e) {
    e.preventDefault();
    var ul = $(this).find("ul");
    if ($(this).hasClass("active")) {
        if (ul.find("li").is(e.target)) {
            var target = $(e.target);
            target.addClass("selected").siblings().removeClass("selected");
            var value = target.html();
            $(this).find(".btn-select-input").val(value);
            $(this).find(".btn-select-value").html(value);
        }
        ul.hide();
        $(this).removeClass("active");
    }
    else {
        $('.btn-select').not(this).each(function () {
            $(this).removeClass("active").find("ul").hide();
        });
        ul.slideDown(300);
        $(this).addClass("active");
    }
});

$(document).on('click', function (e) {
    var target = $(e.target).closest(".btn-select");
    if (!target.length) {
        $(".btn-select").removeClass("active").find("ul").hide();
    }
});


 // Compute of the coords of the progress bar for the three steps
    function carouselMarqueur() {
        windowW = $(window).width();
        containerWidth = $('#home-carousel .carousel-indicators + .container').eq(0).width();
        containerLeft = Math.round((windowW - containerWidth) / 2);
        pillWidth = 35;
        liWidth = $('.nav-pills li').eq(0).innerWidth();
        bubleLeftFromBorderContainer = Math.round((liWidth - pillWidth) / 2);

        hrRightStart = containerLeft + bubleLeftFromBorderContainer + pillWidth;
        $(".transition-timer-carousel-progress-bar").css("left", hrRightStart + "px");

        hrRightSlide1End = 2 * bubleLeftFromBorderContainer;

        hrRightSlide2Start = hrRightSlide1End + pillWidth;
        hrRightSlide2End = hrRightSlide2Start + (2 * bubleLeftFromBorderContainer);

        hrRightSlide3Start = hrRightSlide2End + pillWidth;
        hrRightSlide3End = hrRightSlide3Start + (2 * bubleLeftFromBorderContainer);

        hrRightSlide4Start = hrRightSlide3End + pillWidth;
        hrRightSlide4End = hrRightSlide4Start + (2 * bubleLeftFromBorderContainer);

        hrRightSlide5Start = hrRightSlide4End + pillWidth;
        hrRightSlide5End = hrRightSlide5Start + (2);

        hrLeftStart = -(bubleLeftFromBorderContainer + containerLeft);
        $(".transition-timer-carousel-left-progress-bar").css("left", hrLeftStart + "px");
        hrLeftEnd = -hrLeftStart + containerLeft + bubleLeftFromBorderContainer;
    }

    $(document).ready(function () {

        /* call and change coords for the progress bar on resize */
        carouselMarqueur();
        $(window).resize(function () {
            carouselMarqueur();
        });
    
        //Events that reset and restart the progress bar when the slides change
        $("#transition-timer-carousel").on("slide.bs.carousel", function (event) {
            var currentSlide = $(event.relatedTarget).index();
            
            //The animate class gets removed so that it jumps straight back to indicated px
            if (currentSlide == 0) {
                $(".transition-timer-carousel-progress-bar", this)
                        .addClass("stopanimation")
                        .removeClass("animate")
                        .css("width", "0");
                $(".transition-timer-carousel-left-progress-bar", this)
                        .addClass("stopanimation")
                        .removeClass("animate")
                        .css("width", hrLeftEnd + "px");
                $('.nav li').removeClass('active');
                $('.Fifth-li').removeClass('active');
                $('.Fourth-li').removeClass('active');
                $('.third-li').removeClass('active');
                $('.second-li').removeClass('active');
                $('.first-li').removeClass('active');

            }
            else if (currentSlide == 1) {
                $(".transition-timer-carousel-progress-bar", this)
                        .addClass("stopanimation")
                        .removeClass("animate")
                        .css("width", hrRightSlide2Start + "px");

                $(".transition-timer-carousel-left-progress-bar", this)
                        .addClass("stopanimation")
                        .removeClass("animate")
                        .css("width", hrLeftEnd + "px");
                $('.nav li').removeClass('active');
                $('.first-li').addClass('active');
            }
             else if (currentSlide == 2) {
                $(".transition-timer-carousel-progress-bar", this)
                        .addClass("stopanimation")
                        .removeClass("animate")
                        .css("width", hrRightSlide3Start + "px");

                $(".transition-timer-carousel-left-progress-bar", this)
                        .addClass("stopanimation")
                        .removeClass("animate")
                        .css("width", hrLeftEnd + "px");
                $('.nav li').removeClass('active');
                $('.second-li').addClass('active');
                $('.first-li').addClass('active');
            }
             else if (currentSlide == 3) {
                $(".transition-timer-carousel-progress-bar", this)
                        .addClass("stopanimation")
                        .removeClass("animate")
                        .css("width", hrRightSlide4Start + "px");

                $(".transition-timer-carousel-left-progress-bar", this)
                        .addClass("stopanimation")
                        .removeClass("animate")
                        .css("width", hrLeftEnd + "px");
                $('.nav li').removeClass('active');
                $('.third-li').addClass('active');
                $('.second-li').addClass('active');
                $('.first-li').addClass('active');
            }
            else if (currentSlide == 4) {
                $(".transition-timer-carousel-progress-bar", this)
                        .addClass("stopanimation")
                        .removeClass("animate")
                        .css("width", hrRightSlide5Start + "px");
                $(".transition-timer-carousel-left-progress-bar", this)
                        .addClass("stopanimation")
                        .removeClass("animate")
                        .css("width", "0");
                $('.nav li').removeClass('active');
                $('.Fourth-li').addClass('active');
                $('.third-li').addClass('active');
                $('.second-li').addClass('active');
                $('.first-li').addClass('active');
            }
        }).on("slid.bs.carousel", function (event) {
            //The slide transition finished, so re-add the animate class so that
            //the timer bar takes time to fill up to indicated px
        
            var currentSlide = $(event.relatedTarget).index();
            if (currentSlide == 0) {
                $(".transition-timer-carousel-progress-bar", this)
                        .removeClass("stopanimation")
                        .addClass("animate")
                        .css("width", hrRightSlide1End + "px");
                $('.nav li').removeClass('active');
                $('.first-li').addClass('active');

            }
            else if (currentSlide == 1) {
                $(".transition-timer-carousel-progress-bar", this)
                        .removeClass("stopanimation")
                        .addClass("animate")
                        .css("width", hrRightSlide2End + "px");
                $('.nav li').removeClass('active');
                $('.first-li').addClass('active');
                $('.second-li').addClass('active');
                
            }
            else if (currentSlide == 2) {
                $(".transition-timer-carousel-progress-bar", this)
                        .removeClass("stopanimation")
                        .addClass("animate")
                        .css("width", hrRightSlide3End + "px");
                $('.nav li').removeClass('active');
                $('.third-li').addClass('active');
                 $('.second-li').addClass('active');
                $('.first-li').addClass('active');
            }
            else if (currentSlide == 3) {
                $(".transition-timer-carousel-progress-bar", this)
                        .removeClass("stopanimation")
                        .addClass("animate")
                        .css("width", hrRightSlide4End + "px");
                $('.nav li').removeClass('active');
                $('.Fourth-li').addClass('active');
                $('.third-li').addClass('active');
                 $('.second-li').addClass('active');
                $('.first-li').addClass('active');
            }
            else if (currentSlide == 4) {
                $(".transition-timer-carousel-progress-bar", this)
                        .removeClass("stopanimation")
                        .addClass("animate")
                        .css("width", hrRightSlide5End + "px");
                $(".transition-timer-carousel-left-progress-bar", this)
                        .removeClass("stopanimation")
                        .addClass("animate")
                        .css("width", hrLeftEnd + "px");
                $('.nav li').removeClass('active');
                $('.Fifth-li').addClass('active');

                 $('.Fourth-li').addClass('active');
                $('.third-li').addClass('active');
                 $('.second-li').addClass('active');
                $('.first-li').addClass('active');
            }
        });

        /* Kick off the initial slide animation when the document is ready */
        $(".transition-timer-carousel-progress-bar", "#transition-timer-carousel")
                .css("width", hrRightSlide1End + "px");
        $(".transition-timer-carousel-left-progress-bar", "#transition-timer-carousel")
                .removeClass("animate").css("width", hrLeftEnd + "px");

        // bootstrap carousel native script modified
        var clickEvent = false;
        $('#transition-timer-carousel')
                .on('click', '.nav li', function () {
                    clickEvent = true;
                    $('.nav li').removeClass('active');
                    var currentSlide = window.getComputedStyle(this,':before').content;
                    // alert(currentSlide);

                    $(this).addClass('active');
                    if(currentSlide.indexOf('1')>=0){
                        $('.first-li').addClass('active');
                        $('.Fifth-li').removeClass('active');

                 $('.Fourth-li').removeClass('active');
                $('.third-li').removeClass('active');
                 $('.second-li').removeClass('active');
                
                    }
                    if(currentSlide.indexOf('2')>=0){
                        $('.Fifth-li').removeClass('active');

                 $('.Fourth-li').removeClass('active');
                $('.third-li').removeClass('active');
                
                
                    }
                    if(currentSlide.indexOf('3')>=0){
                        $('.Fifth-li').removeClass('active');

                 $('.Fourth-li').removeClass('active');
               
                
                
                    }
                    if(currentSlide.indexOf('4')>=0){
                        $('.Fifth-li').removeClass('active');
                
                    }
                })
                // modif: "on slide" instead of "on slid". Goal: the buble colors in blue directly at the end of the progress bar, not after the transition.
                // .on('slide.bs.carousel', function () {
                //     if (!clickEvent) {
                //         var count = $('.nav').children().length - 1;
                //         var current = $('.nav li.active').length;

                //         //current.removeClass('active').next().addClass('active');
                //         var id = parseInt(current.data('slide-to'));
                //         if (current == id) {
                //             $('.nav li').addClass('active');
                //         }
                //     }
                //     clickEvent = false;
                // });

    });